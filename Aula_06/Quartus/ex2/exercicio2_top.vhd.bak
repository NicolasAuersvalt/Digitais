library ieee;
use ieee.std_logic_1164.all;

entity exercicio2_top is
    port(
        CLK_50MHz : in  std_logic; -- Pino 12
        BTN_START : in  std_logic; -- Botão de Start
        BTN_RST   : in  std_logic; -- Botão de Reset (Opcional, usado para limpar)

        D7S_LSD   : out std_logic_vector(6 downto 0); -- Display Unidade (Seu LSD)
        D7S_MSD   : out std_logic_vector(6 downto 0); -- Display Dezena (Seu MSD)

        DP_LSD    : out std_logic; -- Pontos decimais (Debug visual)
        DP_MSD    : out std_logic
    );
end exercicio2_top;

architecture struct of exercicio2_top is

    -- 1. Componente Divisor (Gera 1Hz e 100Hz)
    component divider is
        generic(divisor_50M: integer := 25000000; divisor_50M2: integer := 250000);
        port(
            clk_in              : in std_logic;
            clk_out1, clk_out2  : out std_logic
        );
    end component;

    -- 2. Componente Debounce
    component debounce_v1 is
        generic(counter_size: integer := 4);
        port(
            clk    : in  std_logic;
            button : in  std_logic;
            result : out std_logic
        );
    end component;

    -- 3. SEU Componente (A lógica do RA)
    component sequencia_ra_vhdl is
        port (
            clk, start : in  std_logic;
            msd, lsd   : out std_logic_vector(6 downto 0)                
        );
    end component;

    signal s_clk_1hz   : std_logic;
    signal s_clk_100hz : std_logic;
    signal s_start_clean : std_logic;

begin

    -- Divisor de Frequência
    U1: divider
        generic map(divisor_50M => 25000000, divisor_50M2 => 250000)
        port map(clk_in => CLK_50MHz, clk_out1 => s_clk_1hz, clk_out2 => s_clk_100hz);

    -- Debounce do Botão Start (Invertido com 'not' se o botão for Active Low)
    U2: debounce_v1
        port map(clk => s_clk_100hz, button => not BTN_START, result => s_start_clean);

    -- Conexão com o SEU código
    U_CORE: sequencia_ra_vhdl
        port map(
            clk   => s_clk_1hz,      -- Clock de 1 segundo
            start => s_start_clean,  -- Botão limpo
            msd   => D7S_MSD,        -- Saída para Dezena
            lsd   => D7S_LSD         -- Saída para Unidade
        );

    -- Debug: Pisca os pontos decimais com o clock de 1s
    DP_LSD <= s_clk_1hz;
    DP_MSD <= not s_clk_1hz;

end struct;